<!DOCTYPE HTML>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>反向查询</title>

    <link href="/plugins/bootstrap-3.3.0/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/plugins/material-design-iconic-font-2.2.0/css/material-design-iconic-font.min.css" rel="stylesheet"/>
    <link href="/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet"/>

    <link href="/plugins/bootstrap-table-1.11.0/bootstrap-table.min.css" rel="stylesheet"/>
    <link href="/plugins/waves-0.7.5/waves.min.css" rel="stylesheet"/>
    <link href="/plugins/jquery-confirm/jquery-confirm.min.css" rel="stylesheet"/>

    <!--select2-->
    <link href="https://cdn.bootcss.com/select2/4.0.3/css/select2.min.css" rel="stylesheet"/>

    <link href="/app/css/common.css" rel="stylesheet"/>
    <script src="/plugins/jquery.1.12.4.min.js"></script>
    <script src="/plugins/bootstrap-3.3.0/js/bootstrap.min.js"></script>
    <script src="/plugins/jquery-confirm/jquery-confirm.min.js"></script>
</head>
<body>
<div id="main">
    <table class="table table-condensed table-striped text-center " border="1" id="rev-table">
        <tr>
            <td></td>
            <td></td>
            <td colspan="10" class="text-center">公开日</td>
        </tr>
        <!--<tr><td rowspan="2"></td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td></tr>-->
        <!--<tr></td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td></tr>-->
    </table>
</div>
<script src="https://cdn.bootcss.com/moment.js/2.18.1/moment.min.js"></script>
<script>
    $(document).ready(function () {
        $.post("/pat/display",function (res) {
            if (res){
                console.info(res);
                var arr = new Array();
                if(res.length>0){
                    for(var x=0;x<res.length;x++){
                        var ipcObj = res[x];
                        console.info(ipcObj);
                        if (x==0){
                            /* head line */
                            var startYear = ipcObj.startYear;
                            arr.push("<tr><td valign='middle'>分类号</td><td>专利名称</td>");
                            while (startYear<=ipcObj.endYear){
                                arr.push("<td>"+startYear+"</td>")
                                startYear = startYear+1;
                            }
                            arr.push("</tr>");
                        }

                        /*  body line */
                        for(var y =0 ;y<ipcObj.data.length;y++){
                            var line  = ipcObj.data[y];
                            console.info(line);
                            arr.push("<tr>");
                            if(0==y){
                                arr.push("<td valign='middle' style='vertical-align: middle;' rowspan='"+ipcObj.data.length+"'>IPC</td>")
                            }
                            // arr.push("<td onclick='detailDialog("+line+")' >"+line[12]+"</td>")
                            arr.push('<td onclick=detailDialog('+JSON.stringify(line).replace(/\"/g,"'")+')      >'+line[12]+'</td>')
                            var index = ipcObj.startYear;
                            while (index<=ipcObj.endYear){
                                if (line[1]){
                                    // console.info(line[1].getFullYear());
                                    var ipcYear = new Date(line[1]).getFullYear();
                                    if (ipcYear==index){
                                        arr.push("<td>1</td>");
                                    }else {
                                        arr.push("<td></td>");
                                    }
                                }else{
                                    arr.push("<td>0</td>")
                                }
                                index = index+1;
                            }
                            arr.push("</tr>");
                        }




                    }

                }

                $("#rev-table").append(arr.join(""));
            }
        });
    })


    window.actionEvents = {
        'click .detail': function (e, value, row) {
            detailDialog(row);
        },
    };


    function detailDialog(row) {
        // location.href = href + "#" + row.pid;
        console.info(row)
        patDetail = $.dialog({
            boxWidth:'80%',
            columnClass: 'medium',
            type: 'blue',
            animationSpeed: 300,
            title: '专利详情',
            content: 'url:/page/pat/detail.html',
            onContentReady:function () {
                $("#pid").text(row[0]);
                $("#name").text(row[12]);
                $("#industry").text(row[8]);
                $("#applyNo").text(row[3]);
                $("#tongZu").text(row[17]);
                $("#yinZheng").text(row[18]);
                $("#beiYin").text(row[7]);
                $("#applyDate").text(dateFormatter(new Date(row[1])));
                $("#publicNo").text(row[16]);
                $("#publicDate").text(dateFormatter(new Date(row[15])));
                $("#ipctypeNo").text(row[2]);
                $("#applyPerson").text(row[4]);
                $("#inventor").text(row[9]);
                $("#priorityNumber").text(row.priorityNumber);
                $("#priorityDay").text(row[14]);
                $("#applyPersonAddress").text(row[5]);
                $("#applyPersonZip").text(row[6]);
                $("#legalEffectiveDate").text(row[10]);
                $("#legalEffectiveMeaning").text(row[11]);
            }
        });
    }
    function dateFormatter(date) {
        return date ? moment(date).format("YYYY-MM-DD") : '-';
    }
</script>

</body>
</html>